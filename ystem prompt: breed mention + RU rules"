[1mdiff --git a/cloudflare/agent-worker/mamascota-agent/scripts/deploy-worker.sh b/cloudflare/agent-worker/mamascota-agent/scripts/deploy-worker.sh[m
[1mnew file mode 100644[m
[1mindex 00000000..f62e1269[m
[1m--- /dev/null[m
[1m+++ b/cloudflare/agent-worker/mamascota-agent/scripts/deploy-worker.sh[m
[36m@@ -0,0 +1,13 @@[m
[32m+[m[32m#!/usr/bin/env bash[m
[32m+[m[32mset -euo pipefail[m
[32m+[m
[32m+[m[32mcd "$(git rev-parse --show-toplevel)"[m
[32m+[m[32mcd cloudflare/agent-worker/mamascota-agent[m
[32m+[m
[32m+[m[32mif [ -z "${CLOUDFLARE_API_TOKEN:-}" ]; then[m
[32m+[m[32m  echo "ERROR: CLOUDFLARE_API_TOKEN is not set."[m
[32m+[m[32m  echo "Add it to GitHub Codespaces secrets or export it in your shell."[m
[32m+[m[32m  exit 1[m
[32m+[m[32mfi[m
[32m+[m
[32m+[m[32mnpx wrangler deploy[m
[1mdiff --git a/cloudflare/agent-worker/mamascota-agent/src/brain/buildAgentContext.ts b/cloudflare/agent-worker/mamascota-agent/src/brain/buildAgentContext.ts[m
[1mindex b64ca418..dc08260d 100644[m
[1m--- a/cloudflare/agent-worker/mamascota-agent/src/brain/buildAgentContext.ts[m
[1m+++ b/cloudflare/agent-worker/mamascota-agent/src/brain/buildAgentContext.ts[m
[36m@@ -8,10 +8,11 @@[m [mfunction normalizePet(p: any) {[m
   return {[m
     id: p?.id || null,[m
     name: p?.name || "Sin nombre",[m
[31m-    species: p?.species || "No especificada",[m
[32m+[m[32m    species: p?.species || "No especificada",  // 'dog' | 'cat' | ...[m
[32m+[m[32m    speciesLabel: p?.speciesLabel || null,     // üÜï –≥–æ—Ç–æ–≤–æ–µ —Å–ª–æ–≤–æ: –ü—ë—Å / –°–æ–±–∞–∫–∞ / –ö–æ—Ç / –ö–æ—à–∫–∞...[m
     breed: p?.breed || null,[m
     sex: p?.sex || "No indicado",[m
[31m-    ageYears: p?.ageYears || null, // –∫–∞–∫ –≤ proxy buildAgentContext.mjs (—á–µ—Ä–µ–∑ ||)[m
[32m+[m[32m    ageYears: p?.ageYears ?? null,[m
     neutered: !!p?.neutered,[m
   };[m
 }[m
[36m@@ -19,29 +20,6 @@[m [mfunction normalizePet(p: any) {[m
 function norm(s = "") {[m
   return String(s).toLowerCase().trim().replace(/\s+/g, " ");[m
 }[m
[31m-function getSpeciesI18nKey(species: any, sex: any): string | null {[m
[31m-  const sp = typeof species === "string" ? species.trim().toLowerCase() : "";[m
[31m-  const sx = sex === "male" || sex === "female" ? sex : null;[m
[31m-[m
[31m-  if (!sp) return null;[m
[31m-[m
[31m-  // dog/cat –∏–º–µ—é—Ç —Ä–∞–∑–≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É (–∫–∞–∫ —É —Ç–µ–±—è –≤ –ª–æ–∫–∞–ª—è—Ö)[m
[31m-  if (sp === "dog") {[m
[31m-    if (sx === "male") return "animal_dog_male";[m
[31m-    if (sx === "female") return "animal_dog_female";[m
[31m-    return "animal_dog";[m
[31m-  }[m
[31m-  if (sp === "cat") {[m
[31m-    if (sx === "male") return "animal_cat_male";[m
[31m-    if (sx === "female") return "animal_cat_female";[m
[31m-    return "animal_cat";[m
[31m-  }[m
[31m-[m
[31m-  // –æ—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∏–¥—ã ‚Äî –ø—Ä—è–º—ã–µ –∫–ª—é—á–∏ animal_{species}[m
[31m-  // (–¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Ç–µ–º, —á—Ç–æ —É —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å: rabbit, ferret, bird, rodent, reptile, fish, exotic)[m
[31m-  return `animal_${sp}`;[m
[31m-}[m
[31m-[m
 [m
 export async function buildAgentContext([m
   pet: any = {},[m
[36m@@ -53,12 +31,6 @@[m [mexport async function buildAgentContext([m
     const lang = userLang || pet?.lang || "en";[m
 [m
     const petData = normalizePet(pet);[m
[31m-    const speciesI18nKey = getSpeciesI18nKey(petData.species, petData.sex);[m
[31m-[m
[31m-    const sexKey =[m
[31m-      petData.sex === "male" || petData.sex === "female"[m
[31m-        ? petData.sex[m
[31m-        : "unknown";[m
 [m
     // –î–∞–Ω–Ω—ã–µ —É–∂–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ JSON[m
     const knowledgeBase = KNOWLEDGE_BASE || { algorithms: [], clinicalDetails: [], breedRisks: [] };[m
[36m@@ -129,50 +101,38 @@[m [mexport async function buildAgentContext([m
       ? `S√≠ntomas reportados: ${symptomKeys.join(", ")}.`[m
       : "No se han indicado s√≠ntomas espec√≠ficos.";[m
 [m
[31m-    const context = `[m
[31m-üß© Contexto cl√≠nico del paciente:[m
[31m-Nombre: ${petData.name || "Desconocido"}[m
[31m-EspecieKey: ${petData.species || "-"}[m
[31m-SpeciesI18nKey: ${speciesI18nKey || "-"}[m
[31m-SexoKey: ${petData.sex === "male" || petData.sex === "female" ? petData.sex : "unknown"}[m
[31m-Raza: ${petData.breed || "No especificada"}[m
[31m-Edad: ${petData.ageYears || "Sin datos"} a√±os[m
[31m-Esterilizado: ${petData.neutered ? "S√≠" : "No"}[m
[31m-[m
[31m-üåê Idioma del usuario: ${langText}[m
[31m-${symptomText}[m
[31m-    `.trim();[m
[32m+[m[32m    const especieText =[m
[32m+[m[32m      petData.speciesLabel ||      // üÜï –ü—ë—Å / –°–æ–±–∞–∫–∞ / –ö–æ—Ç / –ö–æ—à–∫–∞...[m
[32m+[m[32m      petData.species ||           // fallback[m
[32m+[m[32m      "No especificada";[m
 [m
[31m-  return JSON.stringify({[m
[31m-    pet: {[m
[31m-      // ‚¨ÖÔ∏è –≤—Å—ë, —á—Ç–æ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ[m
[31m-      ...petData,[m
[32m+[m[32m    const context = `[m
[32m+[m[32m    üß© Contexto cl√≠nico del paciente:[m
[32m+[m[32m    Nombre: ${petData.name || "Desconocido"}[m
[32m+[m[32m    Especie: ${especieText}[m
[32m+[m[32m    Raza: ${petData.breed || "No especificada"}[m
[32m+[m[32m    Sexo: ${petData.sex || "No indicado"}[m
[32m+[m[32m    Edad: ${petData.ageYears || "Sin datos"} a√±os[m
[32m+[m[32m    Esterilizado: ${petData.neutered ? "S√≠" : "No"}[m
 [m
[31m-      // üß∑ –∫–ª—é—á –ª–æ–∫–∞–ª–∏ –≤–∏–¥–∞ (—Å—Ç—Ä–æ–≥–æ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏)[m
[31m-      speciesI18nKey,[m
[32m+[m[32m    üåê Idioma del usuario: ${langText}[m
[32m+[m[32m    ${symptomText}[m
[32m+[m[32m        `.trim();[m
 [m
[31m-      // üîë –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª –¥–ª—è –ø—Ä–∞–≤–∏–ª –ø—Ä–æ–º–ø—Ç–∞[m
[31m-      sexKey,[m
[31m-    },[m
 [m
[32m+[m[32m  return JSON.stringify({[m
[32m+[m[32m    pet: petData,[m
     userLang: lang,[m
     symptomKeys,[m
     nivelUsuario: nivelFilter,[m
[31m-[m
[31m-    // –ê–ª–≥–æ—Ä–∏—Ç–º—ã[m
     algorithms: finalAlgorithms,[m
[31m-[m
[31m-    // –ö–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ[m
     clinical_details_for_species: clinicalDetailsForSpecies,[m
     breed_risks_for_pet: breedRisksForPet,[m
[31m-[m
[31m-    // –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏[m
     knowledgeBase: filteredAlgorithms,[m
[31m-[m
[31m-    // –¢–µ–∫—Å—Ç–æ–≤–∞—è —Å–≤–æ–¥–∫–∞ (—Å–ª—É–∂–µ–±–Ω–∞—è)[m
     context,[m
   });[m
 [m
[32m+[m
   } catch (error: any) {[m
     return JSON.stringify({[m
       error: "Error al generar el contexto cl√≠nico.",[m
[1mdiff --git a/cloudflare/agent-worker/mamascota-agent/src/brain/systemPrompt.ts b/cloudflare/agent-worker/mamascota-agent/src/brain/systemPrompt.ts[m
[1mindex 691f66b6..9a97519c 100644[m
[1m--- a/cloudflare/agent-worker/mamascota-agent/src/brain/systemPrompt.ts[m
[1m+++ b/cloudflare/agent-worker/mamascota-agent/src/brain/systemPrompt.ts[m
[36m@@ -63,15 +63,15 @@[m [mJSON ‚Äî –æ—Å–Ω–æ–≤–∞ –¥–∏–∞–ª–æ–≥–∞, –Ω–æ —Ç—ã –Ω–µ –æ–±—è–∑–∞–Ω —è–≤–Ω–æ –æ–ø[m
 [m
 –í–∏–¥, –≤–æ–∑—Ä–∞—Å—Ç, –ø–æ—Ä–æ–¥–∞, –ø–æ–ª, —Å—Ç–µ—Ä–∏–ª–∏–∑–∞—Ü–∏—è ‚Äî –ù–ï–ò–ó–ú–ï–ù–Ø–ï–ú–´.[m
 [m
[31m-–ï—Å–ª–∏ –ø–æ—Ä–æ–¥–∞ —É–∫–∞–∑–∞–Ω–∞ –∏ –∏–∑–≤–µ—Å—Ç–Ω–∞ —Å–≤–æ–µ–π –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–æ–π,[m
[31m-—Ç—ã –º–æ–∂–µ—à—å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ —É–ø–æ–º—è–Ω—É—Ç—å –µ—ë –∫–∞–∫ —Ñ–∞–∫—Ç–æ—Ä –Ω–∞–±–ª—é–¥–µ–Ω–∏—è[m
[31m-(–∫–æ–∂–∞, —É—à–∏, –¥—ã—Ö–∞–Ω–∏–µ, –æ–±–º–µ–Ω),[m
[31m-–±–µ–∑ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –∑–∞–±–æ–ª–µ–≤–∞–Ω–∏–π –∏ –±–µ–∑ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∏–∞–≥–Ω–æ–∑–æ–≤.[m
[31m-[m
[31m-–ï—Å–ª–∏ –ø–æ—Ä–æ–¥–∞ = Metis / Crossbreed / Other:[m
[31m-–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏;[m
[31m-–ø–æ—Ä–æ–¥–Ω—ã–µ —Ä–∏—Å–∫–∏ –Ω–µ –≤—ã–¥—É–º—ã–≤–∞—é—Ç—Å—è.[m
[32m+[m[32m–ü–û–†–û–î–ê ‚Äî –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û–ï –£–ü–û–ú–ò–ù–ê–ù–ò–ï[m
 [m
[32m+[m[32m–ï—Å–ª–∏ –≤ JSON –µ—Å—Ç—å pet.breed (–Ω–µ –ø—É—Å—Ç–æ):[m
[32m+[m[32m‚Äì –í –ü–ï–†–í–û–ú —Å–æ–æ–±—â–µ–Ω–∏–∏ —Ç—ã –û–ë–Ø–ó–ê–ù –Ω–∞–∑–≤–∞—Ç—å –ø–æ—Ä–æ–¥—É –≤–º–µ—Å—Ç–µ —Å –≤–∏–¥–æ–º –∏ –≤–æ–∑—Ä–∞—Å—Ç–æ–º.[m
[32m+[m[32m‚Äì –í –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–ò —Ç—ã –û–ë–Ø–ó–ê–ù —Å–Ω–æ–≤–∞ –Ω–∞–∑–≤–∞—Ç—å –ø–æ—Ä–æ–¥—É (–∫–æ—Ä–æ—Ç–∫–æ, 1 —Ä–∞–∑).[m
[32m+[m[32m‚Äì –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–ª—è –ª—é–±–æ–π –ø–æ—Ä–æ–¥—ã, –≤–∫–ª—é—á–∞—è Metis / Crossbreed / Mix / Other.[m
[32m+[m[32m‚Äì –ù–µ–ª—å–∑—è ‚Äú–ø—Ä–æ–ø—É—Å–∫–∞—Ç—å‚Äù –ø–æ—Ä–æ–¥—É –∏–∑-–∑–∞ —Å–æ–º–Ω–µ–Ω–∏–π –≤ –∫–ª–∏–Ω–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏.[m
[32m+[m[32m‚Äì –ù–µ–ª—å–∑—è –∑–∞–º–µ–Ω—è—Ç—å –ø–æ—Ä–æ–¥—É –æ–±—â–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ (‚Äú—Å–æ–±–∞–∫–∞‚Äù, ‚Äú–∫–æ—à–∫–∞‚Äù), –µ—Å–ª–∏ –ø–æ—Ä–æ–¥–∞ –¥–∞–Ω–∞.[m
[32m+[m[32m–ï—Å–ª–∏ –ø–æ—Ä–æ–¥–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è ‚Äî –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π.[m
 [m
 –ì–µ—Ä–∏–∞—Ç—Ä–∏—è[m
 [m
[36m@@ -287,8 +287,6 @@[m [mt√©cnico / experto ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∞ —Ä–∏[m
 –ü–∏—à–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ: –ø—Ä–æ—â–µ —Å–ª–æ–≤–∞, –º–µ–Ω—å—à–µ –∫–∞–Ω—Ü–µ–ª—è—Ä–∏—Ç–∞.[m
 –ò–∑–±–µ–≥–∞–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–æ–≥–æ –∏ –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ –∂–∞—Ä–≥–æ–Ω–∞. –°–ª–µ–¥–∏ –∑–∞ –æ—Ä—Ñ–æ–≥—Ä–∞—Ñ–∏–µ–π –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ —è–∑—ã–∫–∞.[m
 [m
[31m-[m
[31m-[m
 7.1 –†–ï–ñ–ò–ú –°–ë–û–†–ê –î–ê–ù–ù–´–• (–ß–¢–û–ë–´ –û–ü–†–û–° –ù–ï –ë–ï–°–ò–õ)[m
 [m
 –í –Ω–∞—á–∞–ª–µ –¥–∏–∞–ª–æ–≥–∞ –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –æ–¥–∏–Ω ¬´—Å–±–æ—Ä–Ω—ã–π¬ª –≤–æ–ø—Ä–æ—Å[m
[36m@@ -299,11 +297,119 @@[m [mt√©cnico / experto ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∞ —Ä–∏[m
 –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞—ë—Ç –∫–æ—Ä–æ—Ç–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –∏–ª–∏ —É—Å—Ç–∞–ª:[m
 –Ω–µ —Ä–∞—Å—à–∏—Ä—è–π –æ–ø—Ä–æ—Å, –≤—ã–±–∏—Ä–∞–π —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É.[m
 [m
[32m+[m[32m‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[m
[32m+[m[32mRU-–°–ü–ï–¶–ò–§–ò–ß–ï–°–ö–ò–ï –ü–†–ê–í–ò–õ–ê (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)[m
[32m+[m
[32m+[m[32m–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —è–∑—ã–∫ –æ—Ç–≤–µ—Ç–∞ ‚Äî —Ä—É—Å—Å–∫–∏–π (ru).[m
[32m+[m
[32m+[m[32mA. –ö–û–ù–¢–†–û–õ–¨ –§–ê–ó –î–ò–ê–õ–û–ì–ê[m
[32m+[m
[32m+[m[32m–î–∏–∞–ª–æ–≥ –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –¢–û–õ–¨–ö–û –≤ –û–î–ù–û–ô —Ñ–∞–∑–µ:[m
[32m+[m
[32m+[m[32m1) —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö[m
[32m+[m[32m2) —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è[m
[32m+[m[32m3) –ø–æ—Å—Ç-—Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º (–æ—Ç–≤–µ—Ç—ã –ø–æ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)[m
[32m+[m
[32m+[m[32m–ó–∞–ø—Ä–µ—â–µ–Ω–æ:[m
[32m+[m[32m‚Äì –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ —Å–±–æ—Ä—É –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏;[m
[32m+[m[32m‚Äì —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—é–º–µ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö;[m
[32m+[m[32m‚Äì –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ—Å–ª–µ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.[m
[32m+[m
[32m+[m[32m–ï—Å–ª–∏ –Ω–∞—á–∞–ª–∞—Å—å —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.[m
[32m+[m
[32m+[m[32mB. RED FLAGS (–ñ–Å–°–¢–ö–û)[m
[32m+[m
[32m+[m[32m–ü—Ä–∏ –≤—ã—è–≤–ª–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ red flag:[m
[32m+[m
[32m+[m[32m‚Äì –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏ —Å–±–æ—Ä –∞–Ω–∞–º–Ω–µ–∑–∞;[m
[32m+[m[32m‚Äì –ù–ï –∑–∞–¥–∞–≤–∞–π —É—Ç–æ—á–Ω—è—é—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤;[m
[32m+[m[32m‚Äì –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è –∫ —Å–±–æ—Ä—É –¥–∞–Ω–Ω—ã—Ö;[m
[32m+[m[32m‚Äì —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏;[m
[32m+[m[32m‚Äì —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –û–î–ò–ù —Ä–∞–∑.[m
[32m+[m
[32m+[m[32m–ü–æ—Å–ª–µ red flag:[m
[32m+[m[32m—Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,[m
[32m+[m[32m–ù–û –±–µ–∑ –Ω–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏.[m
[32m+[m
[32m+[m[32mC. –†–ï–ó–Æ–ú–ï –ò –ü–ï–†–ï–°–ö–ê–ó[m
[32m+[m
[32m+[m[32m–ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ –ó–ê–ü–†–ï–©–ï–ù–û:[m
[32m+[m
[32m+[m[32m‚Äì –ø–æ–≤—Ç–æ—Ä—è—Ç—å —Å–∏–º–ø—Ç–æ–º—ã –∞–±–∑–∞—Ü–∞–º–∏;[m
[32m+[m[32m‚Äì –ø–µ—Ä–µ—Å–∫–∞–∑—ã–≤–∞—Ç—å —É–∂–µ —Å–∫–∞–∑–∞–Ω–Ω–æ–µ ¬´—á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º¬ª;[m
[32m+[m[32m‚Äì —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—é–º–µ –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞.[m
[32m+[m
[32m+[m[32m–†–µ–∑—é–º–µ:[m
[32m+[m[32m‚Äì —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –¢–û–õ–¨–ö–û –≤ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏;[m
[32m+[m[32m‚Äì –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è;[m
[32m+[m[32m‚Äì –Ω–µ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è;[m
[32m+[m[32m‚Äì –Ω–µ —É—Ç–æ—á–Ω—è–µ—Ç—Å—è.[m
[32m+[m
[32m+[m[32mD. –î–õ–ò–ù–ê –ò –§–û–†–ú–ê –û–¢–í–ï–¢–ê (RU)[m
[32m+[m
[32m+[m[32m–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –î–û —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏:[m
[32m+[m[32m‚Äì –º–∞–∫—Å–∏–º—É–º 2 –∫–æ—Ä–æ—Ç–∫–∏—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è;[m
[32m+[m[32m‚Äì –∑–∞—Ç–µ–º –û–î–ò–ù –≤–æ–ø—Ä–æ—Å;[m
[32m+[m[32m‚Äì –±–µ–∑ –æ–±—ä—è—Å–Ω—è—é—â–∏—Ö –∞–±–∑–∞—Ü–µ–≤;[m
[32m+[m[32m‚Äì –±–µ–∑ –≤–≤–æ–¥–Ω—ã—Ö —Å–ª–æ–≤ (¬´—ç—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º —á—Ç–æ‚Ä¶¬ª, ¬´—Ç–∞–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç‚Ä¶¬ª).[m
[32m+[m
[32m+[m[32m–ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±–æ—Ä:[m
[32m+[m[32m–æ–±—ä—è—Å–Ω—è—Ç—å –∏–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç—å ‚Äî –°–ü–†–ê–®–ò–í–ê–ô.[m
[32m+[m
[32m+[m[32mE. PDF –ò –°–û–•–†–ê–ù–ï–ù–ò–ï[m
[32m+[m
[32m+[m[32m–ù–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ:[m
[32m+[m
[32m+[m[32m‚Äì –Ω–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π —Ä–µ–∑—é–º–µ –∏ PDF –≤–æ –≤—Ä–µ–º—è –¥–∏–∞–ª–æ–≥–∞;[m
[32m+[m[32m‚Äì –Ω–µ —Å–ø—Ä–∞—à–∏–≤–∞–π ¬´–Ω—É–∂–Ω–æ –ª–∏ —Ä–µ–∑—é–º–µ¬ª;[m
[32m+[m[32m‚Äì –Ω–µ –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ –ø–µ—á–∞—Ç—å –∏–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.[m
[32m+[m
[32m+[m[32m–†–∞–∑—Ä–µ—à–µ–Ω–æ:[m
[32m+[m[32m–û–î–ù–ê –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞ –≤ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏[m
[32m+[m[32m–æ —Ç–æ–º, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤–∑—è—Ç—å —Å —Å–æ–±–æ–π.[m
[32m+[m
[32m+[m[32m–ë–µ–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.[m
[32m+[m[32m–ë–µ–∑ –≤–æ–ø—Ä–æ—Å–æ–≤.[m
[32m+[m[32m–ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π.[m
[32m+[m
[32m+[m[32mF. –ó–ê–ü–†–ï–¢ –ù–ê ¬´–ú–ï–¢–ê–î–ò–ê–õ–û–ì¬ª[m
[32m+[m
[32m+[m[32m–ó–∞–ø—Ä–µ—â–µ–Ω–æ:[m
[32m+[m[32m‚Äì –æ–±—Å—É–∂–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏–∞–ª–æ–≥–∞;[m
[32m+[m[32m‚Äì –≥–æ–≤–æ—Ä–∏—Ç—å, —á—Ç–æ —Ç—ã ¬´—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—à—å¬ª, ¬´—Å–æ–±–µ—Ä—ë—à—å¬ª, ¬´–ø–æ–¥–≥–æ—Ç–æ–≤–∏—à—å¬ª;[m
[32m+[m[32m‚Äì –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã –æ —Å–æ—Å—Ç–∞–≤–µ —Ä–µ–∑—é–º–µ.[m
[32m+[m
[32m+[m[32m–¢—ã –ª–∏–±–æ –≤–µ–¥—ë—à—å –¥–∏–∞–ª–æ–≥, –ª–∏–±–æ —É–∂–µ –∑–∞–∫–æ–Ω—á–∏–ª.[m
[32m+[m
[32m+[m[32mG. –†–£–°–°–ö–ò–ï –ù–ê–ó–í–ê–ù–ò–Ø –í–ò–î–ê (–í–ù–£–¢–†–ò –û–¢–í–ï–¢–ê)[m
[32m+[m
[32m+[m[32m–≠—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –∫–∞—Å–∞—é—Ç—Å—è –¢–û–õ–¨–ö–û —Å–ª–æ–≤ ‚Äú–ø—ë—Å/—Å–æ–±–∞–∫–∞/–∫–æ—Ç/–∫–æ—à–∫–∞‚Äù –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –¢–û–õ–¨–ö–û –≤ —Ä—É—Å—Å–∫–æ–º (ru).[m
[32m+[m[32m–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã ‚Äî pet.species –∏ pet.sex –∏–∑ CLINICAL_CONTEXT_JSON.[m
[32m+[m
[32m+[m[32m–ï—Å–ª–∏ pet.species = "dog":[m
[32m+[m[32m‚Äì pet.sex = "male"  ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–≤–æ ¬´–ø—ë—Å¬ª (–Ω–µ ¬´—Å–æ–±–∞–∫–∞¬ª).[m
[32m+[m[32m‚Äì pet.sex = "female" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π —Å–ª–æ–≤–æ ¬´—Å–æ–±–∞–∫–∞¬ª.[m
[32m+[m[32m‚Äì pet.sex –ø—É—Å—Ç–æ–π/–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑—É–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ: ¬´—Å–æ–±–∞–∫–∞¬ª.[m
[32m+[m
[32m+[m[32m–ï—Å–ª–∏ pet.species = "cat":[m
[32m+[m[32m‚Äì pet.sex = "male"  ‚Üí ¬´–∫–æ—Ç¬ª.[m
[32m+[m[32m‚Äì pet.sex = "female" ‚Üí ¬´–∫–æ—à–∫–∞¬ª.[m
[32m+[m[32m‚Äì pet.sex –ø—É—Å—Ç–æ–π/–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω ‚Üí ¬´–∫–æ—à–∫–∞¬ª (–∏–ª–∏ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ ¬´–∫–æ—Ç/–∫–æ—à–∫–∞¬ª –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å; –ª—É—á—à–µ ¬´–∫–æ—à–∫–∞¬ª –∫–∞–∫ –≤–∏–¥).[m
[32m+[m
[32m+[m[32m–ï—Å–ª–∏ pet.species –Ω–µ dog/cat:[m
[32m+[m[32m‚Äì –∏—Å–ø–æ–ª—å–∑—É–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–µ: ¬´–∂–∏–≤–æ—Ç–Ω–æ–µ¬ª / ¬´–ø–∏—Ç–æ–º–µ—Ü¬ª.[m
[32m+[m
[32m+[m[32m–í–∞–∂–Ω–æ:[m
[32m+[m[32m‚Äì —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –Ω–µ –æ—Ç–º–µ–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏–π: –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –ø–æ pet.sex.[m
[32m+[m[32m‚Äì –Ω–µ –æ–±—ä—è—Å–Ω—è–π —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.[m
[32m+[m[32m‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ[m
[32m+[m
[32m+[m
 8. –ü–ï–†–í–´–ô –û–¢–í–ï–¢[m
 [m
 –ï—Å–ª–∏ –≤ JSON –µ—Å—Ç—å –ø–∏—Ç–æ–º–µ—Ü –∏ —Å–∏–º–ø—Ç–æ–º—ã, –ø–µ—Ä–≤—ã–π –æ—Ç–≤–µ—Ç –æ–±—è–∑–∞–Ω:[m
 [m
[31m-–Ω–∞–∑–≤–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞ + –≤–∏–¥ + –≤–æ–∑—Ä–∞—Å—Ç (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ);[m
[32m+[m[32m–Ω–∞–∑–≤–∞—Ç—å –ø–∏—Ç–æ–º—Ü–∞ + –≤–∏–¥ + –≤–æ–∑—Ä–∞—Å—Ç + (–ø–æ—Ä–æ–¥–∞, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞) (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ);[m
 [m
 –∫–æ—Ä–æ—Ç–∫–æ –æ—Ç—Ä–∞–∑–∏—Ç—å 1‚Äì2 —Å–∏–º–ø—Ç–æ–º–∞;[m
 [m
[36m@@ -315,10 +421,6 @@[m [mt√©cnico / experto ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∞ —Ä–∏[m
 [m
 ¬´–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç¬ª.[m
 [m
[31m-–í –ø–µ—Ä–≤–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π –≤–∏–¥ –ø–∏—Ç–æ–º—Ü–∞, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ pet.speciesI18nKey (–∫–ª—é—á –ª–æ–∫–∞–ª–∏ –≤–∏–¥–∞).[m
[31m-[m
[31m-–ï—Å–ª–∏ pet.breed —É–∫–∞–∑–∞–Ω–∞ ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–∑–æ–≤–∏ –ø–æ—Ä–æ–¥—É –≤ –ø–µ—Ä–≤–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ (–≤–∫–ª—é—á–∞—è Crossbreed/Metis/Other/"__other").[m
[31m-[m
 [m
 9. –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–Ø[m
 [m
[36m@@ -335,6 +437,11 @@[m [mt√©cnico / experto ‚Äî —Ç–æ–ª—å–∫–æ –∫–∞–∫ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –∫–∞—Ä—Ç–∞ —Ä–∏[m
   ¬´–≠—Ç–æ –≤—Å—ë, —á—Ç–æ –≤–∞–∂–Ω–æ —Å–µ–π—á–∞—Å¬ª /[m
   ¬´–î–∞–ª—å—à–µ –ª—É—á—à–µ —Ä–µ—à–∞—Ç—å –æ—á–Ω–æ¬ª.[m
 [m
[32m+[m[32m(–ï—Å–ª–∏ –ø–æ—Ä–æ–¥–∞ —É–∫–∞–∑–∞–Ω–∞ –≤ JSON ‚Äî –Ω–∞–∑–æ–≤–∏ –µ—ë –≤ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ 1 —Ä–∞–∑, –∫–æ—Ä–æ—Ç–∫–æ.)[m
[32m+[m
[32m+[m[32m(–ï—Å–ª–∏ —è–∑—ã–∫ = ru, –≤ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–ø—É—Å—Ç–∏–º–∞ –û–î–ù–ê –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —Ñ—Ä–∞–∑–∞:[m
[32m+[m[32m¬´–≠—Ç–æ—Ç –¥–∏–∞–ª–æ–≥ –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –≤ –∫–ª–∏–Ω–∏–∫–µ¬ª. –ë–µ–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.)[m
[32m+[m
 –ü–û–°–õ–ï –§–ò–ù–ê–õ–ò–ó–ê–¶–ò–ò:[m
 [m
 –¢—ã –û–ë–Ø–ó–ê–ù –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–∏–∞–ª–æ–≥.[m
[1mdiff --git a/package.json b/package.json[m
[1mindex 91ebe92a..1e8538a5 100644[m
[1m--- a/package.json[m
[1m+++ b/package.json[m
[36m@@ -7,7 +7,9 @@[m
     "type": "module",[m
     "start:clear": "npx expo start --tunnel --clear",[m
     "start:proxy": "cd proxy && npm run proxy:start",[m
[31m-    "dev": "concurrently -n PROXY,EXPO -c magenta,cyan \"npm run start:proxy\" \"npm run start:clear\""[m
[32m+[m[32m    "dev": "concurrently -n PROXY,EXPO -c magenta,cyan \"npm run start:proxy\" \"npm run start:clear\"",[m
[32m+[m[32m    "deploy:worker": "cd cloudflare/agent-worker/mamascota-agent && npx wrangler deploy"[m
[32m+[m
   },[m
   "dependencies": {[m
     "@expo/vector-icons": "^15.0.2",[m
[1mdiff --git a/utils/chatWithGPT.ts b/utils/chatWithGPT.ts[m
[1mindex 48f2cd7c..74c4842d 100644[m
[1m--- a/utils/chatWithGPT.ts[m
[1m+++ b/utils/chatWithGPT.ts[m
[36m@@ -2,6 +2,8 @@[m
 import AsyncStorage from "@react-native-async-storage/async-storage";[m
 import { router } from "expo-router";[m
 import { showExitConfirmation } from "./showExitConfirmation";[m
[32m+[m[32mimport { getLocalizedSpeciesLabel } from "./getLocalizedSpeciesLabel";[m
[32m+[m
 [m
 // –¢–∏–ø –æ—Ç–≤–µ—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç —á–∞—Ç –∏ –¥—Ä—É–≥–∏–µ –≤—ã–∑–æ–≤—ã[m
 export type ChatResult = { ok: boolean; reply?: string; error?: string };[m
[36m@@ -13,6 +15,7 @@[m [mconst AGENT_URL =[m
     ? `${process.env.EXPO_PUBLIC_API_URL}/agent`[m
     : "");[m
 [m
[32m+[m[41m  [m
 /**[m
  * –ö–∞–Ω–æ–Ω–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–∏—Ç–æ–º—Ü–∞.[m
  * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å: pets:list + pets:activeId.[m
[36m@@ -56,7 +59,19 @@[m [mexport async function chatWithGPT(params: {[m
   }[m
 [m
   // üêæ –µ—Å–ª–∏ pet –Ω–µ –ø—Ä–∏—à—ë–ª ‚Äî –±–µ—Ä—ë–º –∏–∑ –µ–¥–∏–Ω–æ–π –º–æ–¥–µ–ª–∏[m
[31m-  const ensuredPet = pet ?? (await getUnifiedActivePet());[m
[32m+[m[32m  // üêæ –µ—Å–ª–∏ pet –Ω–µ –ø—Ä–∏—à—ë–ª ‚Äî –±–µ—Ä—ë–º –∏–∑ –µ–¥–∏–Ω–æ–π –º–æ–¥–µ–ª–∏[m
[32m+[m[32mconst ensuredPet = pet ?? (await getUnifiedActivePet());[m
[32m+[m
[32m+[m[32m// üêæ –¥–æ–±–∞–≤–ª—è–µ–º –≥–æ—Ç–æ–≤—É—é –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å –≤–∏–¥–∞[m
[32m+[m[32mconst petWithLabel = ensuredPet[m
[32m+[m[32m  ? {[m
[32m+[m[32m      ...ensuredPet,[m
[32m+[m[32m      speciesLabel: getLocalizedSpeciesLabel([m
[32m+[m[32m        ensuredPet.species,[m
[32m+[m[32m        ensuredPet.sex[m
[32m+[m[32m      ),[m
[32m+[m[32m    }[m
[32m+[m[32m  : undefined;[m
 [m
   // –Ø–≤–Ω–æ –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π conversationId (–Ω–∞–ø—Ä–∏–º–µ—Ä summary-‚Ä¶)[m
   const explicitConversationId = conversationId ?? null;[m
[36m@@ -91,13 +106,15 @@[m [mexport async function chatWithGPT(params: {[m
     const conversationHistory = isSummaryConversation[m
       ? [][m
       : await getConversationHistoryTail(effectiveConversationId, 20);[m
[32m+[m
[32m+[m
     [m
     const body = {[m
       message: message ?? "",[m
[31m-      pet: ensuredPet ?? undefined,[m
[32m+[m[32m      pet: petWithLabel ?? undefined,[m
       symptomKeys: symptomKeys ?? undefined,[m
       userLang: effectiveLang,[m
[31m-      conversationId: effectiveConversationId,[m
[32m+[m[32m      conversationId: ensuredConversationId,[m
       conversationHistory,[m
     };[m
 [m
[36m@@ -113,7 +130,8 @@[m [mexport async function chatWithGPT(params: {[m
       "üß† conversationHistory tail:",[m
       Array.isArray(body.conversationHistory) ? body.conversationHistory.length : 0[m
     );[m
[31m-[m
[32m+[m[32m    console.log("[CHAT] AGENT_URL =", AGENT_URL);[m
[32m+[m[32m    console.log("[CHAT] payload.pet =", body?.pet);[m
 [m
     const res = await fetch(AGENT_URL, {[m
       method: "POST",[m
